<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#ee6e73" />
	<title>Accounts Web Application</title>
	<link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
	<link rel="manifest" href="/manifest.json">
	<link rel="stylesheet" href="css/materialize.min.css">
	<link href="css/icon.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script src="js/materialize.min.js"></script>  
    <script src="js/app.js"></script>    
</head>
<body>
	
	<nav class="nav-extended">
		<div class="nav-wrapper">
			<a href="#" class="brand-logo">Accounts</a>
			<a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
		</div>
		<div class="nav-content">
			<ul class="tabs tabs-transparent">
				<li class="tab"><a class="active" href="#test1">Test 1</a></li>
				<li class="tab"><a href="#test2">Test 2</a></li>
			</ul>
		</div>
	</nav>
	<div id="test1" class="col s12">
		<div class="progress" style="margin-top: 0px;">
		    <div class="indeterminate"></div>
		</div>
		<div style="width: 300px; margin-top: 20px;">
			<div class="col s12">
				<div class="row">
					<div class="input-field col s12">
						<i class="material-icons prefix">description</i>
						<input type="text" id="autocomplete-input" class="autocomplete">
						<label id=""for="autocomplete-input">Autocomplete</label>
						<ul class="autocomplete-content dropdown-content" id="ac-list"></ul>
					</div>
				</div>
			</div>
		</div>
        <p style="margin-left: 15px;">
        	<i class="material-icons prefix" style="margin-top: 10px; font-size: 30px;">swap_vert</i>
			<input class="with-gap" name="tx-type" type="radio" id="tx-type-debit" value="DEBIT" checked />
			<label for="tx-type-debit" style="margin-left: 10px;">Debit</label>
			<input class="with-gap" name="tx-type" type="radio" id="tx-type-credit" value="CREDIT" />
			<label for="tx-type-credit" style="margin-left: 40px;">Credit</label>
		</p>
		<div class="input-field col s6" style="width: 300px; margin-top: 25px; margin-left: 12px;">
			<i class="material-icons prefix" style="margin-top: 15px;">attach_money</i>
			<input id="icon_prefix" type="text" class="validate">
			<label for="icon_prefix">Amount</label>
        </div>
        <button id="save-btn" class="btn waves-effect waves-light" type="submit" name="action" style="margin-left: 55px; margin-top: 40px;">Submit
			<i class="material-icons right">send</i>
		</button>
	</div>
	<div id="test2" class="col s12">
		<div class="progress prog-listing" style="margin-top: 0px;">
		    <div class="indeterminate"></div>
		</div>
		<table>
			<thead>
				<tr>
					<th>Description</th>
					<th>Type</th>
					<th>Amount</th>
					<th>Date</th>
				</tr>
			</thead>
			<tbody id="listing-content">
			</tbody>
	    </table>
	</div>
	<script type="text/javascript">
		var baseUrl = '/';
		$(document).ready(function(){
			$('div.progress').hide();
			$('div.prog-listing').hide();
			$("a", ".tab").click(function() {
				$('div.prog-listing').show();
				if(this.href.indexOf("#test2") !== -1) {
					var request = $.ajax({
        				url: baseUrl + "/rest/entries",
        				type: "GET",
        	            crossDomain: true,
        			});
		    		request.done(function(response) {
		    			$('#listing-content').html('');
		    			var htmlContent = '';
		    			$.each(response, function(key,value) {
		    				htmlContent += '<tr><td>' + value.transactionName + '</td><td>' + value.transactionType + '</td><td>' + value.amount + '</td></tr>';
		    			});
		    			$('#listing-content').html(htmlContent);
		    			$('div.prog-listing').hide();
		    		});
		    		request.fail(function(jqXHR, textStatus) {
		   		    	alert( "Request failed: " + textStatus );
		        	});	
				}
		    });
			$("input.autocomplete").keyup(function(){
		    	var text = $(this).val();
		        if(text.length >= 4) {
		        	$('div.progress').show();
		        	var request = $.ajax({
		        				url: baseUrl + "/rest/autocomplete/descriptions?text=" + text,
		        				type: "GET",
		        	            crossDomain: true,
		        			});
	        		request.done(function(response) {
	        			var htmlContent = '';
	        			$.each(response, function(key,value) {
	        				htmlContent += '<li onclick="populateAutocomplete(\'' + value.transactionName + '\')"><span>' + value.transactionName + '</span></li>';
	        			});
	        			htmlContent += '</ul>';
	        			$('#ac-list').html(htmlContent);
	        			$('div.progress').hide();
	        		});
	        		request.fail(function(jqXHR, textStatus) {
        		    	alert( "Request failed: " + textStatus );
        		    	$('div.progress').hide();
		        	});
		        } else {
		        	$('#ac-list').html('');
		        }
		    });
			$('#save-btn').click(function() {
				$('div.progress').show();
		    	var requestObject = new Object();
		    	requestObject.transactionName = $('#autocomplete-input').val();
		    	requestObject.transactionType = $("input[name='tx-type']:checked").val();
		    	requestObject.amount = $('#icon_prefix').val();
		    	$.ajax({
					url: baseUrl + "/rest/entry",
					type: "PUT",
					data: JSON.stringify(requestObject),
					dataType: "json",
					contentType: "application/json",
		            crossDomain: true,
					statusCode: {
				        200: function (response) {
				        	$('div.progress').hide();
				        	Materialize.toast('Data Saved', 4000);
				        },
				        400: function (response) {
							$('div.progress').hide();
				        	Materialize.toast(response.responseJSON.message, 4000);
				        },
				        404: function (response) {
		    				$('div.progress').hide();
				        	Materialize.toast('Service unavailable. Try after some time.', 4000);
				      	},
				      	503: function(response) {
							$('div.progress').hide();
				        	Materialize.toast("Internal wiring just crashed. Let us fix it :)", 4000);
				      	}
					},
					success: function () {
						$('div.progress').hide();
			        	Materialize.toast('Data Saved', 4000);
				    }
    			});
		    });
		});
		function populateAutocomplete(text) {
	    	$('#autocomplete-input').val(text);
	    	$('#ac-list').html('');
		}
	</script>
</body>
</html>